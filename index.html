<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Wall - Lời chúc 2k7</title>
    <style>
        /* CSS cho toàn bộ trang và giao diện bắt đầu */
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1; /* Canvas nằm dưới giao diện */
        }
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.7); /* Nền đen mờ */
            z-index: 2; /* Giao diện nằm trên canvas */
            color: white;
            text-align: center;
            transition: opacity 1s ease-out; /* Hiệu ứng mờ dần */
        }
        #start-screen.hidden {
            opacity: 0;
            pointer-events: none; /* Không cho phép tương tác khi đã ẩn */
        }
        #start-screen h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
        }
        #start-screen p {
            font-size: 1.2em;
            margin-bottom: 30px;
            max-width: 80%;
        }
        #name-input {
            padding: 15px;
            font-size: 1.2em;
            border-radius: 10px;
            border: 2px solid white;
            background-color: transparent;
            color: white;
            text-align: center;
            width: 300px;
            margin-bottom: 30px;
            outline: none;
        }
        #name-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        #start-button {
            padding: 15px 40px;
            font-size: 1.5em;
            font-weight: bold;
            color: black;
            background-color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        #start-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.7);
        }
    </style>
</head>
<body>
    <!-- Màn hình chờ với ô nhập tên và nút bấm -->
    <div id="start-screen">
        <h1>Gửi Lời Chúc 2k7</h1>
        <p>Hãy nhập tên của bạn và bắt đầu nhận những lời chúc may mắn cho kỳ thi!</p>
        <input type="text" id="name-input" placeholder="Nhập tên của bạn ở đây...">
        <button id="start-button">Bắt Đầu</button>
    </div>

    <!-- Canvas và Audio -->
    <canvas id="loveWallCanvas"></canvas>
    <audio id="background-music" loop>
        <source src="phepmau.mp3" type="audio/mpeg">
        Trình duyệt của bạn không hỗ trợ phát âm thanh.
    </audio>

    <script>
    // --- Lấy các phần tử HTML ---
    const canvas = document.getElementById('loveWallCanvas');
    const ctx = canvas.getContext('2d');
    const startScreen = document.getElementById('start-screen');
    const nameInput = document.getElementById('name-input');
    const startButton = document.getElementById('start-button');
    const music = document.getElementById('background-music');

    // --- Cài đặt Canvas ---
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // --- CÁC HẰNG SỐ CẤU HÌNH ---
    const PARTICLE_SPAWN_INTERVAL = 0.05; // Giây
    const MIN_VELOCITY_Y_DOWN = 50;
    const MAX_VELOCITY_Y_DOWN_OFFSET = 50;
    const MAX_VELOCITY_X_OFFSET = 50;
    const MIN_FONT_SIZE = 20;
    const MAX_FONT_SIZE_OFFSET = 10;
    const MIN_HEART_SIZE = 25;
    const MAX_HEART_SIZE_OFFSET = 15;
    const MIN_LIFESPAN = 10.0; // seconds
    const MAX_LIFESPAN_OFFSET = 10.0; // seconds

    // --- TEXT GENERATOR ---
    class TextGenerator {
        constructor() {
            this.baseMessages = [
                "Bình tĩnh, tự tin, chiến thắng!", "Chúc các bạn thi tốt môn Toán",
                "Mục tiêu 10 điểm!", "Đỗ nguyện vọng 1 nhé!",
                "Làm bài cẩn thận, không sai ngu", "Cố lên các sĩ tử!",
                "Vượt mọi giới hạn lim", "Hàm số đồng biến, điểm số tăng đều",
                "Tìm max(điểm)", "Oxyz muôn năm", "Tích phân không đổi cận",
                "∫f(x)dx", "x → +∞", "Δ = b² - 4ac", "a² + b² = c²","10 toán","10 toán","10 toán","10 toán","10 toán"
                "sin²α + cos²α = 1", "logₐb", "z = a + bi", "π", "e", "∞", "∀x ∈ R", "f'(x₀)"
            ];
            this.messages = [...this.baseMessages];
        }
        personalize(name) {
            if (name && name.trim() !== '') {
                const trimmedName = name.trim();
                this.messages.push(`Chúc ${trimmedName} thi tốt!`);
                this.messages.push(`${trimmedName} cố lên!`);
                this.messages.push(`${trimmedName} đỗ NV1!`);
            }
        }
        getRandomText() {
            if (this.messages.length === 0) return "Chúc may mắn!";
            return this.messages[Math.floor(Math.random() * this.messages.length)];
        }
    }

    // --- PARTICLE (LỚP CHA) ---
    class Particle {
        constructor(x, y, velocityX, velocityY, lifeSpan) {
            this.x = x;
            this.y = y;
            this.velocityX = velocityX;
            this.velocityY = velocityY;
            this.lifeSpan = lifeSpan;
            this.age = 0;
            this.opacity = 1.0;
            this.alive = true;
        }
        update(deltaTime) {
            if (!this.alive) return;
            this.x += this.velocityX * deltaTime;
            this.y += this.velocityY * deltaTime;
            this.age += deltaTime;
            if (this.age >= this.lifeSpan) {
                this.alive = false;
            } else {
                this.opacity = 1.0 - (this.age / this.lifeSpan);
            }
        }
        render(ctx) {}
    }

    // --- TEXT PARTICLE (VÀ HEART PARTICLE) ---
    class TextParticle extends Particle {
        constructor(text, x, y, velocityX, velocityY, font, color, lifeSpan) {
            super(x, y, velocityX, velocityY, lifeSpan);
            this.text = text;
            this.font = font;
            this.color = color;
        }
        render(ctx) {
            if (!this.alive) return;
            ctx.font = this.font;
            ctx.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${this.opacity})`;
            ctx.fillText(this.text, this.x, this.y);
        }
    }

    // --- PARTICLE FACTORY ---
    class ParticleFactory {
        constructor(textGenerator) {
            this.textGenerator = textGenerator;
        }
        createRandomTextParticle(canvasWidth) {
            const text = this.textGenerator.getRandomText();
            const x = Math.random() * canvasWidth;
            const y = -20;
            const velocityX = (Math.random() - 0.5) * MAX_VELOCITY_X_OFFSET;
            const velocityY = MIN_VELOCITY_Y_DOWN + Math.random() * MAX_VELOCITY_Y_DOWN_OFFSET;
            const fontSize = MIN_FONT_SIZE + Math.random() * MAX_FONT_SIZE_OFFSET;
            const font = `bold ${fontSize}px 'Segoe UI'`;
            const color = { r: Math.floor(Math.random() * 256), g: Math.floor(Math.random() * 256), b: Math.floor(Math.random() * 256) };
            const lifeSpan = MIN_LIFESPAN + Math.random() * MAX_LIFESPAN_OFFSET;
            return new TextParticle(text, x, y, velocityX, velocityY, font, color, lifeSpan);
        }
        createRandomHeartParticle(canvasWidth) {
            const x = Math.random() * canvasWidth;
            const y = -20;
            const velocityX = (Math.random() - 0.5) * MAX_VELOCITY_X_OFFSET * 0.6;
            const velocityY = (MIN_VELOCITY_Y_DOWN * 0.6) + Math.random() * (MAX_VELOCITY_Y_DOWN_OFFSET * 0.6);
            const fontSize = MIN_HEART_SIZE + Math.random() * MAX_HEART_SIZE_OFFSET;
            const font = `bold ${fontSize}px 'Segoe UI'`;
            const color = { r: 255, g: Math.floor(Math.random() * 100), b: Math.floor(Math.random() * 100) };
            const lifeSpan = MIN_LIFESPAN + Math.random() * MAX_LIFESPAN_OFFSET;
            return new TextParticle("❤", x, y, velocityX, velocityY, font, color, lifeSpan);
        }
    }

    // --- PARTICLE SYSTEM ---
    class ParticleSystem {
        constructor() {
            this.particles = [];
        }
        addParticle(particle) {
            this.particles.push(particle);
        }
        update(deltaTime) {
            for (let i = this.particles.length - 1; i >= 0; i--) {
                const p = this.particles[i];
                p.update(deltaTime);
                if (!p.alive) {
                    this.particles.splice(i, 1);
                }
            }
        }
        render(ctx) {
            for (const particle of this.particles) {
                particle.render(ctx);
            }
        }
    }

    // --- KHỞI TẠO CÁC HỆ THỐNG ---
    const textGenerator = new TextGenerator();
    const particleFactory = new ParticleFactory(textGenerator);
    const particleSystem = new ParticleSystem();
    let lastUpdateTime = 0;
    let timeSinceLastSpawn = 0;

    // --- VÒNG LẶP ANIMATION CHÍNH ---
    function animationLoop(currentTime) {
        if (!lastUpdateTime) { lastUpdateTime = currentTime; }
        const deltaTime = (currentTime - lastUpdateTime) / 1000;
        lastUpdateTime = currentTime;

        timeSinceLastSpawn += deltaTime;
        if (timeSinceLastSpawn >= PARTICLE_SPAWN_INTERVAL) {
            if (Math.random() < 0.1) { // 10% là trái tim
                particleSystem.addParticle(particleFactory.createRandomHeartParticle(canvas.width));
            } else { // 90% là chữ
                particleSystem.addParticle(particleFactory.createRandomTextParticle(canvas.width));
            }
            timeSinceLastSpawn = 0;
        }

        particleSystem.update(deltaTime);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particleSystem.render(ctx);

        requestAnimationFrame(animationLoop);
    }

    // --- XỬ LÝ SỰ KIỆN KHI NHẤN NÚT BẮT ĐẦU ---
    startButton.addEventListener('click', () => {
        const userName = nameInput.value;
        textGenerator.personalize(userName);

        // Phát nhạc
        music.play().catch(e => console.error("Không thể phát nhạc:", e));

        // Ẩn màn hình bắt đầu
        startScreen.classList.add('hidden');
        
        // Bắt đầu vòng lặp animation
        requestAnimationFrame(animationLoop);
    });

    // --- XỬ LÝ KHI THAY ĐỔI KÍCH THƯỚC CỬA SỔ ---
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });
    </script>
</body>
</html>
